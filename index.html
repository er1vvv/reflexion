<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Wöchentliche Reflexion</title>
  
  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Reflexion">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#667eea">
  <meta name="description" content="Deine persönliche Reflexions-App für eine bessere Work-Life-Balance">
  
  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iNDAiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcl8xXzEpIi8+CjxwYXRoIGQ9Ik05MCA0NUM2Ny45MDg2IDQ1IDUwIDYyLjkwODYgNTAgODVDNTAgMTA3LjA5MSA2Ny45MDg2IDEyNSA5MCAxMjVDMTEyLjA5MSAxMjUgMTMwIDEwNy4wOTEgMTMwIDg1QzEzMCA2Mi45MDg2IDExMi4wOTEgNDUgOTAgNDVaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNNzUgODVMODUgOTVMMTA1IDc1IiBzdHJva2U9IiM2NjdlZWEiIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MF9saW5lYXJfMV8xIiB4MT0iMCIgeTE9IjAiIHgyPSIxODAiIHkyPSIxODAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N2VlYSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRiYTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0idXJsKCNncmFkaWVudDBfbGluZWFyXzFfMSkiLz4KPHBhdGggZD0iTTE2IDhDMTIuMTMgOCA5IDExLjEzIDkgMTVDOSAxOC44NyAxMi4xMyAyMiAxNiAyMkMxOS44NyAyMiAyMyAxOC44NyAyMyAxNUMyMyAxMS4xMyAxOS44NyA4IDE2IDhaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMTMgMTVMMTUgMTdMMTkgMTMiIHN0cm9rZT0iIzY2N2VlYSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQwX2xpbmVhcl8xXzEiIHgxPSIwIiB5MT0iMCIgeDI9IjMyIiB5Mj0iMzIiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N2VlYSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRiYTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K">

  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --card-bg: rgba(255, 255, 255, 0.95);
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      padding: 1rem;
      color: var(--text-primary);
      padding-top: max(1rem, env(safe-area-inset-top));
      padding-bottom: max(1rem, env(safe-area-inset-bottom));
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .language-selector {
      position: fixed;
      top: max(20px, env(safe-area-inset-top, 20px));
      right: max(20px, env(safe-area-inset-right, 20px));
      z-index: 1000;
    }

    .language-toggle {
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid rgba(102, 126, 234, 0.3);
      border-radius: 25px;
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
      color: #667eea;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      -webkit-tap-highlight-color: transparent;
    }

    .language-toggle:hover, .language-toggle:active {
      background: rgba(102, 126, 234, 0.1);
      border-color: #667eea;
      transform: translateY(-1px);
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 2rem;
      margin-top: 1rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    h2 {
      text-align: center;
      font-size: 2rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1.5rem;
    }

    .nav-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      -webkit-tap-highlight-color: transparent;
    }

    .btn-primary {
      background: var(--primary-gradient);
      color: white;
      box-shadow: var(--shadow);
    }

    .btn-secondary {
      background: var(--secondary-gradient);
      color: white;
      box-shadow: var(--shadow);
    }

    .btn-success {
      background: var(--success-gradient);
      color: white;
      box-shadow: var(--shadow);
    }

    .btn-warning {
      background: var(--warning-gradient);
      color: white;
      box-shadow: var(--shadow);
    }

    .btn-danger {
      background: var(--danger-gradient);
      color: white;
      box-shadow: var(--shadow);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn:active {
      transform: translateY(0);
    }

    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .form-group {
      margin-bottom: 2rem;
    }

    .form-label {
      display: block;
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
      color: var(--text-primary);
    }

    .slider-container {
      position: relative;
      margin: 1rem 0;
    }

    .slider {
      -webkit-appearance: none;
      width: 100%;
      height: 12px;
      border-radius: 6px;
      background: linear-gradient(90deg, #ff6b6b 0%, #ffa500 50%, #4ecdc4 100%);
      outline: none;
      opacity: 0.8;
      transition: opacity 0.2s;
    }

    .slider:hover {
      opacity: 1;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: white;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border: 3px solid #667eea;
      transition: all 0.2s ease;
    }

    .slider::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .slider-value {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary-gradient);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.875rem;
      box-shadow: var(--shadow);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 10;
    }

    .slider-value.show {
      opacity: 1;
    }

    .custom-select select {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 1rem;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.75rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
    }

    .custom-select select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 1rem;
      font-family: inherit;
      resize: vertical;
      min-height: 100px;
      transition: all 0.3s ease;
    }

    .form-textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-textarea::placeholder {
      color: #a0aec0;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 2rem;
    }

    .toolbar {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .table-container {
      overflow-x: auto;
      border-radius: 12px;
      box-shadow: var(--shadow);
      margin-top: 1.5rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }

    th {
      background: var(--primary-gradient);
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 0.875rem;
    }

    td {
      color: var(--text-secondary);
    }

    tr:hover {
      background: rgba(102, 126, 234, 0.05);
    }

    .chart-container {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 2rem;
      box-shadow: var(--shadow);
      overflow-x: auto;
      position: relative;
    }

    #trendChart {
      display: block;
      min-width: 600px;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .trend-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .trend-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      border: 1px solid rgba(102, 126, 234, 0.2);
      transition: transform 0.2s ease;
    }

    .trend-card:hover {
      transform: translateY(-2px);
    }

    .trend-value {
      font-size: 2rem;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 0.5rem;
    }

    .trend-label {
      color: var(--text-secondary);
      font-weight: 600;
    }

    .notification {
      position: fixed;
      top: 80px;
      right: 20px;
      background: var(--success-gradient);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: var(--shadow-lg);
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .notification.show {
      opacity: 1;
      transform: translateX(0);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
        margin-top: 3rem;
      }
      
      .nav-buttons {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
        max-width: 300px;
      }
      
      .toolbar {
        flex-direction: column;
        align-items: center;
      }
      
      .button-group {
        flex-direction: column;
        align-items: center;
      }

      .trend-summary {
        grid-template-columns: 1fr;
      }

      .card {
        padding: 1.5rem;
      }

      .language-toggle {
        padding: 0.5rem 0.8rem;
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Language Selector -->
    <div class="language-selector">
      <button id="languageToggle" class="language-toggle">🇺🇸 EN</button>
    </div>

    <h1 id="mainTitle">✨ Wöchentliche Reflexion ✨</h1>

    <div class="nav-buttons">
      <button id="btnForm" class="btn btn-primary">📝 Fragebogen ausfüllen</button>
      <button id="btnOverview" class="btn btn-secondary">📊 Übersicht & Statistik</button>
    </div>

    <!-- Formular-Ansicht -->
    <section id="formSection">
      <div class="card">
        <h2 id="formTitle">Wie war deine Woche?</h2>
        <form id="reflectionForm">
          <div class="form-group">
            <label class="form-label" for="zufriedenheit" id="labelSatisfaction">Allgemeine Zufriedenheit</label>
            <div class="slider-container">
              <div class="slider-value" id="zufriedenheitValue">5</div>
              <input type="range" id="zufriedenheit" name="zufriedenheit" min="1" max="10" value="5" class="slider" required />
              <div class="slider-labels" id="labelsSatisfaction">
                <span>😞 Sehr unzufrieden</span>
                <span>😊 Sehr zufrieden</span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="stress" id="labelStress">Stresslevel</label>
            <div class="slider-container">
              <div class="slider-value" id="stressValue">5</div>
              <input type="range" id="stress" name="stress" min="1" max="10" value="5" class="slider" required />
              <div class="slider-labels" id="labelsStress">
                <span>😌 Sehr entspannt</span>
                <span>😰 Sehr gestresst</span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="erfolge" id="labelSuccesses">🎉 Besondere Erfolge & Highlights</label>
            <textarea id="erfolge" name="erfolge" class="form-textarea" placeholder="Was lief diese Woche besonders gut? Worauf bist du stolz?"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label" for="herausforderungen" id="labelChallenges">💭 Herausforderungen & Lernmomente</label>
            <textarea id="herausforderungen" name="herausforderungen" class="form-textarea" placeholder="Welche Situationen waren herausfordernd? Was hast du daraus gelernt?"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label" for="team" id="labelTeam">Zusammenarbeit im Team</label>
            <div class="slider-container">
              <div class="slider-value" id="teamValue">5</div>
              <input type="range" id="team" name="team" min="1" max="10" value="5" class="slider" />
              <div class="slider-labels" id="labelsTeam">
                <span>🤝 Schwierig</span>
                <span>🌟 Hervorragend</span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="wertschaetzung" id="labelAppreciation">💝 Fühlte ich mich wertgeschätzt?</label>
            <div class="custom-select">
              <select id="wertschaetzung" name="wertschaetzung">
                <option value="ja">✅ Ja, definitiv</option>
                <option value="nein">❌ Nein, leider nicht</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="grenzen" id="labelBoundaries">Eigene Bedürfnisse & Grenzen gewahrt</label>
            <div class="slider-container">
              <div class="slider-value" id="grenzenValue">5</div>
              <input type="range" id="grenzen" name="grenzen" min="1" max="10" value="5" class="slider" />
              <div class="slider-labels" id="labelsBoundaries">
                <span>🚫 Gar nicht</span>
                <span>✅ Vollständig</span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="fazit" id="labelSummary">🎯 Gesamtfazit der Woche</label>
            <div class="custom-select">
              <select id="fazit" name="fazit">
                <option value="positiv">🌟 Positiv</option>
                <option value="negativ">😔 Negativ</option>
              </select>
            </div>
          </div>

          <div class="button-group">
            <button type="submit" class="btn btn-success" id="btnSave">💾 Eintrag speichern</button>
            <button type="reset" class="btn btn-warning" id="btnReset">🔄 Zurücksetzen</button>
          </div>
        </form>
      </div>
    </section>

    <!-- Übersicht-Ansicht -->
    <section id="overviewSection" style="display:none;">
      <div class="card">
        <h2 id="overviewTitle">📈 Deine Reflexions-Übersicht</h2>
        
        <div class="toolbar">
          <button id="btnExportCSV" class="btn btn-primary">📊 Export als CSV</button>
          <button id="btnBackupJSON" class="btn btn-secondary">💾 Backup exportieren</button>
          <button id="btnImportJSON" class="btn btn-success">📂 Backup importieren</button>
          <input type="file" id="fileInput" accept="application/json" style="display:none;" />
          <button id="btnClearAll" class="btn btn-danger">🗑️ Alle löschen</button>
        </div>

        <div id="trendSummary" class="trend-summary"></div>

        <div class="table-container">
          <table id="entriesTable">
            <thead>
              <tr>
                <th>Datum</th>
                <th>Zufriedenheit</th>
                <th>Stress</th>
                <th>Erfolge</th>
                <th>Herausforderungen</th>
                <th>Team</th>
                <th>Wertschätzung</th>
                <th>Grenzen</th>
                <th>Fazit</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="chart-container">
          <canvas id="trendChart" width="800" height="400"></canvas>
        </div>
      </div>
    </section>
  </div>

  <!-- Notification -->
  <div id="notification" class="notification">
    <span id="notificationText"></span>
  </div>

  <script>
    // Global Variables
    let reflectionData = [];
    let currentLanguage = 'de';
    const STORAGE_KEY = 'reflexionsDaten';

    // Translations
    const translations = {
      de: {
        mainTitle: '✨ Wöchentliche Reflexion ✨',
        btnForm: '📝 Fragebogen ausfüllen',
        btnOverview: '📊 Übersicht & Statistik',
        formTitle: 'Wie war deine Woche?',
        satisfaction: 'Allgemeine Zufriedenheit',
        stress: 'Stresslevel',
        successes: '🎉 Besondere Erfolge & Highlights',
        successesPlaceholder: 'Was lief diese Woche besonders gut? Worauf bist du stolz?',
        challenges: '💭 Herausforderungen & Lernmomente',
        challengesPlaceholder: 'Welche Situationen waren herausfordernd? Was hast du daraus gelernt?',
        teamwork: 'Zusammenarbeit im Team',
        appreciation: '💝 Fühlte ich mich wertgeschätzt?',
        boundaries: 'Eigene Bedürfnisse & Grenzen gewahrt',
        summary: '🎯 Gesamtfazit der Woche',
        btnSave: '💾 Eintrag speichern',
        btnReset: '🔄 Zurücksetzen',
        overviewTitle: '📈 Deine Reflexions-Übersicht',
        btnExportCSV: '📊 Export als CSV',
        btnBackup: '💾 Backup exportieren',
        btnImport: '📂 Backup importieren',
        btnClearAll: '🗑️ Alle löschen',
        veryDissatisfied: '😞 Sehr unzufrieden',
        verySatisfied: '😊 Sehr zufrieden',
        veryRelaxed: '😌 Sehr entspannt',
        veryStressed: '😰 Sehr gestresst',
        difficult: '🤝 Schwierig',
        excellent: '🌟 Hervorragend',
        notAtAll: '🚫 Gar nicht',
        completely: '✅ Vollständig',
        yesDefinitely: '✅ Ja, definitiv',
        noUnfortunately: '❌ Nein, leider nicht',
        positive: '🌟 Positiv',
        negative: '😔 Negativ',
        avgSatisfaction: '⭐ Durchschnittliche Zufriedenheit',
        avgStress: '😤 Durchschnittlicher Stress',
        avgTeam: '🤝 Team-Zusammenarbeit',
        positiveWeeks: '🌟 Positive Wochen',
        savedSuccess: '✅ Eintrag erfolgreich gespeichert!',
        noEntries: 'Keine Einträge zum Exportieren.',
        exportSuccess: '📊 CSV Export erfolgreich!',
        backupSuccess: '💾 Backup erfolgreich erstellt!',
        importSuccess: '📂 Backup erfolgreich importiert!',
        deletedSuccess: '🗑️ Alle Einträge wurden gelöscht.',
        confirmDelete: 'Wirklich alle Einträge löschen? Diese Aktion kann nicht rückgängig gemacht werden.',
        emptyStateText: 'Noch keine Einträge vorhanden.',
        emptyStateSubtext: 'Fülle den ersten Fragebogen aus! 🚀',
        chartEmpty: '📈 Fülle Einträge aus, um Trends zu sehen'
      },
      en: {
        mainTitle: '✨ Weekly Reflection ✨',
        btnForm: '📝 Fill out questionnaire',
        btnOverview: '📊 Overview & Statistics',
        formTitle: 'How was your week?',
        satisfaction: 'General satisfaction',
        stress: 'Stress level',
        successes: '🎉 Special successes & highlights',
        successesPlaceholder: 'What went particularly well this week? What are you proud of?',
        challenges: '💭 Challenges & learning moments',
        challengesPlaceholder: 'Which situations were challenging? What did you learn from them?',
        teamwork: 'Teamwork',
        appreciation: '💝 Did I feel appreciated?',
        boundaries: 'Own needs & boundaries maintained',
        summary: '🎯 Overall summary of the week',
        btnSave: '💾 Save entry',
        btnReset: '🔄 Reset',
        overviewTitle: '📈 Your reflection overview',
        btnExportCSV: '📊 Export as CSV',
        btnBackup: '💾 Export backup',
        btnImport: '📂 Import backup',
        btnClearAll: '🗑️ Delete all',
        veryDissatisfied: '😞 Very dissatisfied',
        verySatisfied: '😊 Very satisfied',
        veryRelaxed: '😌 Very relaxed',
        veryStressed: '😰 Very stressed',
        difficult: '🤝 Difficult',
        excellent: '🌟 Excellent',
        notAtAll: '🚫 Not at all',
        completely: '✅ Completely',
        yesDefinitely: '✅ Yes, definitely',
        noUnfortunately: '❌ No, unfortunately not',
        positive: '🌟 Positive',
        negative: '😔 Negative',
        avgSatisfaction: '⭐ Average satisfaction',
        avgStress: '😤 Average stress',
        avgTeam: '🤝 Teamwork',
        positiveWeeks: '🌟 Positive weeks',
        savedSuccess: '✅ Entry saved successfully!',
        noEntries: 'No entries to export.',
        exportSuccess: '📊 CSV export successful!',
        backupSuccess: '💾 Backup created successfully!',
        importSuccess: '📂 Backup imported successfully!',
        deletedSuccess: '🗑️ All entries have been deleted.',
        confirmDelete: 'Really delete all entries? This action cannot be undone.',
        emptyStateText: 'No entries available yet.',
        emptyStateSubtext: 'Fill out the first questionnaire! 🚀',
        chartEmpty: '📈 Fill out entries to see trends'
      }
    };

    // DOM Elements
    const formSection = document.getElementById('formSection');
    const overviewSection = document.getElementById('overviewSection');
    const btnForm = document.getElementById('btnForm');
    const btnOverview = document.getElementById('btnOverview');
    const form = document.getElementById('reflectionForm');
    const tbody = document.querySelector('#entriesTable tbody');

    // Utility Functions
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      const notificationText = document.getElementById('notificationText');
      
      notificationText.textContent = message;
      notification.className = `notification show ${type}`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    function t(key) {
      return translations[currentLanguage][key] || key;
    }

    // Language System
    function updateLanguage() {
      const elements = {
        mainTitle: 'mainTitle',
        btnForm: 'btnForm', 
        btnOverview: 'btnOverview',
        formTitle: 'formTitle',
        satisfaction: 'labelSatisfaction',
        stress: 'labelStress',
        successes: 'labelSuccesses',
        challenges: 'labelChallenges',
        teamwork: 'labelTeam',
        appreciation: 'labelAppreciation',
        boundaries: 'labelBoundaries',
        summary: 'labelSummary',
        btnSave: 'btnSave',
        btnReset: 'btnReset',
        overviewTitle: 'overviewTitle',
        btnExportCSV: 'btnExportCSV',
        btnBackup: 'btnBackupJSON',
        btnImport: 'btnImportJSON',
        btnClearAll: 'btnClearAll'
      };

      // Update text elements
      Object.entries(elements).forEach(([key, id]) => {
        const element = document.getElementById(id);
        if (element) {
          element.textContent = t(key);
        }
      });

      // Update placeholders
      document.getElementById('erfolge').placeholder = t('successesPlaceholder');
      document.getElementById('herausforderungen').placeholder = t('challengesPlaceholder');
      
      // Update slider labels
      document.getElementById('labelsSatisfaction').innerHTML = `<span>${t('veryDissatisfied')}</span><span>${t('verySatisfied')}</span>`;
      document.getElementById('labelsStress').innerHTML = `<span>${t('veryRelaxed')}</span><span>${t('veryStressed')}</span>`;
      document.getElementById('labelsTeam').innerHTML = `<span>${t('difficult')}</span><span>${t('excellent')}</span>`;
      document.getElementById('labelsBoundaries').innerHTML = `<span>${t('notAtAll')}</span><span>${t('completely')}</span>`;
      
      // Update select options
      const wertschaetzungSelect = document.getElementById('wertschaetzung');
      wertschaetzungSelect.innerHTML = `
        <option value="ja">${t('yesDefinitely')}</option>
        <option value="nein">${t('noUnfortunately')}</option>
      `;
      
      const fazitSelect = document.getElementById('fazit');
      fazitSelect.innerHTML = `
        <option value="positiv">${t('positive')}</option>
        <option value="negativ">${t('negative')}</option>
      `;
      
      // Update language toggle button
      const toggleBtn = document.getElementById('languageToggle');
      toggleBtn.textContent = currentLanguage === 'de' ? '🇺🇸 EN' : '🇩🇪 DE';
      
      // Update chart if visible
      if (overviewSection.style.display !== 'none') {
        renderTrendSummary();
        renderChart();
      }
    }

    // Slider Management
    const sliders = ['zufriedenheit', 'stress', 'team', 'grenzen'];
    sliders.forEach(sliderId => {
      const slider = document.getElementById(sliderId);
      const valueDisplay = document.getElementById(sliderId + 'Value');
      
      slider.addEventListener('input', (e) => {
        const value = e.target.value;
        valueDisplay.textContent = value;
        valueDisplay.classList.add('show');
        
        const percentage = (value - slider.min) / (slider.max - slider.min) * 100;
        valueDisplay.style.left = `${percentage}%`;
      });
      
      slider.addEventListener('mouseenter', () => {
        valueDisplay.classList.add('show');
      });
      
      slider.addEventListener('mouseleave', () => {
        valueDisplay.classList.remove('show');
      });

      slider.addEventListener('touchstart', () => {
        valueDisplay.classList.add('show');
      });
      
      slider.addEventListener('touchend', () => {
        setTimeout(() => valueDisplay.classList.remove('show'), 1000);
      });
    });

    // Navigation
    btnForm.addEventListener('click', () => {
      formSection.style.display = 'block';
      overviewSection.style.display = 'none';
    });

    btnOverview.addEventListener('click', () => {
      formSection.style.display = 'none';
      overviewSection.style.display = 'block';
      renderTable();
      renderTrendSummary();
      renderChart();
    });

    // Language toggle
    document.getElementById('languageToggle').addEventListener('click', () => {
      currentLanguage = currentLanguage === 'de' ? 'en' : 'de';
      localStorage.setItem('selectedLanguage', currentLanguage);
      updateLanguage();
    });

    // Data Management
    function loadEntries() {
      try {
        const json = localStorage.getItem(STORAGE_KEY);
        return json ? JSON.parse(json) : [];
      } catch (error) {
        console.error('Error loading data:', error);
        return [];
      }
    }

    function saveEntries(entries) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
        reflectionData = entries;
      } catch (error) {
        console.error('Error saving data:', error);
        showNotification('Fehler beim Speichern!', 'error');
      }
    }

    // Form Submission
    form.addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(form);

      const entry = {
        id: Date.now(),
        datum: new Date().toISOString().slice(0, 10),
        zufriedenheit: Number(formData.get('zufriedenheit')),
        stress: Number(formData.get('stress')),
        erfolge: formData.get('erfolge').trim(),
        herausforderungen: formData.get('herausforderungen').trim(),
        team: formData.get('team') ? Number(formData.get('team')) : null,
        wertschaetzung: formData.get('wertschaetzung'),
        grenzen: formData.get('grenzen') ? Number(formData.get('grenzen')) : null,
        fazit: formData.get('fazit')
      };

      const entries = loadEntries();
      entries.push(entry);
      saveEntries(entries);

      showNotification(t('savedSuccess'));
      
      form.reset();
      
      // Reset sliders to default
      sliders.forEach(sliderId => {
        const slider = document.getElementById(sliderId);
        const valueDisplay = document.getElementById(sliderId + 'Value');
        slider.value = 5;
        valueDisplay.textContent = '5';
      });
    });

    // Table Rendering
    function renderTable() {
      const entries = loadEntries();
      tbody.innerHTML = '';
      
      if (entries.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="9" class="empty-state">
              <div>
                <p>${t('emptyStateText')}</p>
                <p>${t('emptyStateSubtext')}</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }
      
      entries.sort((a, b) => new Date(b.datum) - new Date(a.datum));
      
      entries.forEach(e => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><strong>${e.datum}</strong></td>
          <td><span style="color: ${e.zufriedenheit >= 7 ? '#4ecdc4' : e.zufriedenheit >= 4 ? '#ffa500' : '#ff6b6b'}">${e.zufriedenheit}/10</span></td>
          <td><span style="color: ${e.stress <= 3 ? '#4ecdc4' : e.stress <= 6 ? '#ffa500' : '#ff6b6b'}">${e.stress}/10</span></td>
          <td>${e.erfolge || '—'}</td>
          <td>${e.herausforderungen || '—'}</td>
          <td>${e.team !== null ? `<span style="color: ${e.team >= 7 ? '#4ecdc4' : e.team >= 4 ? '#ffa500' : '#ff6b6b'}">${e.team}/10</span>` : '—'}</td>
          <td>${e.wertschaetzung === 'ja' ? '✅ Ja' : '❌ Nein'}</td>
          <td>${e.grenzen !== null ? `<span style="color: ${e.grenzen >= 7 ? '#4ecdc4' : e.grenzen >= 4 ? '#ffa500' : '#ff6b6b'}">${e.grenzen}/10</span>` : '—'}</td>
          <td>${e.fazit === 'positiv' ? '🌟 Positiv' : '😔 Negativ'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Trend Summary
    function renderTrendSummary() {
      const entries = loadEntries();
      const summaryContainer = document.getElementById('trendSummary');
      
      if (entries.length === 0) {
        summaryContainer.innerHTML = '';
        return;
      }

      const avgZufriedenheit = entries.reduce((sum, e) => sum + e.zufriedenheit, 0) / entries.length;
      const avgStress = entries.reduce((sum, e) => sum + e.stress, 0) / entries.length;
      const teamEntries = entries.filter(e => e.team !== null);
      const avgTeam = teamEntries.length > 0 ? teamEntries.reduce((sum, e) => sum + e.team, 0) / teamEntries.length : 0;
      const positivWeeks = entries.filter(e => e.fazit === 'positiv').length;
      const totalWeeks = entries.length;

      summaryContainer.innerHTML = `
        <div class="trend-card">
          <div class="trend-value">${avgZufriedenheit.toFixed(1)}</div>
          <div class="trend-label">${t('avgSatisfaction')}</div>
        </div>
        <div class="trend-card">
          <div class="trend-value">${avgStress.toFixed(1)}</div>
          <div class="trend-label">${t('avgStress')}</div>
        </div>
        <div class="trend-card">
          <div class="trend-value">${avgTeam ? avgTeam.toFixed(1) : '—'}</div>
          <div class="trend-label">${t('avgTeam')}</div>
        </div>
        <div class="trend-card">
          <div class="trend-value">${Math.round(positivWeeks / totalWeeks * 100)}%</div>
          <div class="trend-label">${t('positiveWeeks')}</div>
        </div>
      `;
    }

    // Simple Chart Rendering
    function renderChart() {
      const entries = loadEntries();
      const canvas = document.getElementById('trendChart');
      const ctx = canvas.getContext('2d');
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      if (entries.length === 0) {
        ctx.fillStyle = '#a0aec0';
        ctx.font = '18px -apple-system, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(t('chartEmpty'), canvas.width / 2, canvas.height / 2);
        return;
      }

      entries.sort((a, b) => new Date(a.datum) - new Date(b.datum));

      // Adjust canvas width for horizontal scroll
      const minWidth = 600;
      const optimalWidth = Math.max(minWidth, entries.length * 100 + 120);
      canvas.width = optimalWidth;
      canvas.style.width = optimalWidth + 'px';

      const padding = 60;
      const chartWidth = canvas.width - (padding * 2);
      const chartHeight = canvas.height - (padding * 2);

      // Background
      ctx.fillStyle = '#f8f9fa';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Grid lines
      ctx.strokeStyle = '#e2e8f0';
      ctx.lineWidth = 1;
      
      for (let i = 1; i <= 10; i++) {
        const y = padding + chartHeight - ((i - 1) / 9) * chartHeight;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(padding + chartWidth, y);
        ctx.stroke();
        
        ctx.fillStyle = '#4a5568';
        ctx.font = '12px -apple-system, sans-serif';
        ctx.textAlign = 'right';
        ctx.fillText(i.toString(), padding - 10, y + 4);
      }

      // Draw lines
      function drawLine(data, color) {
        ctx.strokeStyle = color;
        ctx.lineWidth = 3;
        ctx.beginPath();

        let firstPoint = true;
        for (let i = 0; i < data.length; i++) {
          if (data[i] !== null) {
            const x = padding + (i / Math.max(entries.length - 1, 1)) * chartWidth;
            const y = padding + chartHeight - ((data[i] - 1) / 9) * chartHeight;
            
            if (firstPoint) {
              ctx.moveTo(x, y);
              firstPoint = false;
            } else {
              ctx.lineTo(x, y);
            }
          }
        }
        ctx.stroke();

        // Draw points
        ctx.fillStyle = color;
        for (let i = 0; i < data.length; i++) {
          if (data[i] !== null) {
            const x = padding + (i / Math.max(entries.length - 1, 1)) * chartWidth;
            const y = padding + chartHeight - ((data[i] - 1) / 9) * chartHeight;
            
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 10px -apple-system, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(data[i].toString(), x, y + 3);
            ctx.fillStyle = color;
          }
        }
      }

      // Data preparation
      const zufriedenheitData = entries.map(e => e.zufriedenheit);
      const stressData = entries.map(e => e.stress);
      const teamData = entries.map(e => e.team);
      const grenzenData = entries.map(e => e.grenzen);

      // Draw all lines
      drawLine(zufriedenheitData, '#4ecdc4');
      drawLine(stressData, '#ff6b6b');
      drawLine(teamData, '#667eea');
      drawLine(grenzenData, '#ffa500');

      // X-axis labels (with proper date formatting for current language)
      ctx.fillStyle = '#4a5568';
      ctx.font = '12px -apple-system, sans-serif';
      ctx.textAlign = 'center';
      
      for (let i = 0; i < entries.length; i++) {
        const x = padding + (i / Math.max(entries.length - 1, 1)) * chartWidth;
        const date = new Date(entries[i].datum).toLocaleDateString(currentLanguage === 'de' ? 'de-DE' : 'en-US', { 
          day: '2-digit', 
          month: '2-digit' 
        });
        ctx.fillText(date, x, padding + chartHeight + 20);
      }

      // Legend
      const legendItems = [
        { color: '#4ecdc4', label: currentLanguage === 'de' ? '😊 Zufriedenheit' : '😊 Satisfaction' },
        { color: '#ff6b6b', label: currentLanguage === 'de' ? '😰 Stress' : '😰 Stress' },
        { color: '#667eea', label: currentLanguage === 'de' ? '🤝 Team' : '🤝 Team' },
        { color: '#ffa500', label: currentLanguage === 'de' ? '✅ Grenzen' : '✅ Boundaries' }
      ];

      let legendX = padding;
      const legendY = 30;

      legendItems.forEach(item => {
        ctx.fillStyle = item.color;
        ctx.fillRect(legendX, legendY - 10, 12, 12);
        
        ctx.fillStyle = '#4a5568';
        ctx.font = '14px -apple-system, sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText(item.label, legendX + 20, legendY);
        
        legendX += ctx.measureText(item.label).width + 60;
      });

      // Chart title
      ctx.fillStyle = '#2d3748';
      ctx.font = 'bold 16px -apple-system, sans-serif';
      ctx.textAlign = 'center';
      const chartTitle = currentLanguage === 'de' ? '📈 Entwicklung der Bewertungen' : '📈 Development of Ratings';
      ctx.fillText(chartTitle, canvas.width / 2, 20);
    }

    // Export Functions
    function downloadFile(content, filename, contentType) {
      const blob = new Blob([content], { type: contentType });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Event Listeners for Export/Import
    document.getElementById('btnExportCSV').addEventListener('click', () => {
      const entries = loadEntries();
      if (entries.length === 0) {
        showNotification(t('noEntries'), 'error');
        return;
      }
      
      const header = ['Datum', 'Zufriedenheit', 'Stress', 'Erfolge', 'Herausforderungen', 'Team', 'Wertschätzung', 'Grenzen', 'Fazit'];
      const csvRows = [header.join(',')];

      entries.forEach(e => {
        const row = [
          e.datum,
          e.zufriedenheit,
          e.stress,
          `"${e.erfolge.replace(/"/g, '""')}"`,
          `"${e.herausforderungen.replace(/"/g, '""')}"`,
          e.team !== null ? e.team : '',
          e.wertschaetzung,
          e.grenzen !== null ? e.grenzen : '',
          e.fazit
        ];
        csvRows.push(row.join(','));
      });

      const csvString = csvRows.join('\n');
      const filename = `reflexion_export_${new Date().toISOString().slice(0, 10)}.csv`;
      
      downloadFile(csvString, filename, 'text/csv;charset=utf-8;');
      showNotification(t('exportSuccess'));
    });

    document.getElementById('btnBackupJSON').addEventListener('click', () => {
      const entries = loadEntries();
      if (entries.length === 0) {
        showNotification(t('noEntries'), 'error');
        return;
      }
      
      const jsonStr = JSON.stringify(entries, null, 2);
      const filename = `reflexion_backup_${new Date().toISOString().slice(0, 10)}.json`;
      
      downloadFile(jsonStr, filename, 'application/json');
      showNotification(t('backupSuccess'));
    });

    const fileInput = document.getElementById('fileInput');
    document.getElementById('btnImportJSON').addEventListener('click', () => {
      fileInput.value = '';
      fileInput.click();
    });

    fileInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = event => {
        try {
          const importedData = JSON.parse(event.target.result);
          if (!Array.isArray(importedData)) throw new Error('Ungültiges Format');
          
          saveEntries(importedData);
          showNotification(t('importSuccess'));
          
          if (overviewSection.style.display !== 'none') {
            renderTable();
            renderTrendSummary();
            renderChart();
          }
        } catch (err) {
          showNotification('Fehler beim Importieren: ' + err.message, 'error');
        }
      };
      reader.readAsText(file);
    });

    document.getElementById('btnClearAll').addEventListener('click', () => {
      if (confirm(t('confirmDelete'))) {
        localStorage.removeItem(STORAGE_KEY);
        reflectionData = [];
        showNotification(t('deletedSuccess'));
        renderTable();
        renderTrendSummary();
        renderChart();
      }
    });

    // Initialize App
    function initApp() {
      reflectionData = loadEntries();
      
      // Load saved language preference
      const savedLanguage = localStorage.getItem('selectedLanguage');
      if (savedLanguage) {
        currentLanguage = savedLanguage;
      }
      
      updateLanguage();
      
      // Show form initially
      formSection.style.display = 'block';
      overviewSection.style.display = 'none';
    }

    // Start the app
    initApp();
  </script>
</body>
</html>
